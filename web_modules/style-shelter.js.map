{"version":3,"file":"style-shelter.js","sources":["../node_modules/style-shelter/style-shelter.js"],"sourcesContent":["export default {\n    get ERROR_NO_SCOPE_MESSAGE() { return 'No default scope/element offered to use for adopting stylesheet: '; },\n\n    /**\n     * get default configuration\n     * @returns {{baseURI: string, theme: string}|*}\n     */\n    get config() {\n        return {\n            append: [document],\n            onSuccess: null,\n            onError: function (err, message) {\n                console.warn(err, err.message);\n            }\n        }\n    },\n\n    /**\n     * adopt a list of sheets or sheet objects\n     * @param sheetObjects - array of CSS URLs or objects containing url and scope keys\n     * @param defaultScope - scope to adopt CSS like document or shadow root\n     * @param config\n     */\n    adopt(sheetObjects, defaultScope, config) {\n        if (!config) {\n            config = this.config;\n        }\n        const scopes = new WeakMap();\n        const scopekeys = [];\n        if (defaultScope) {\n            scopekeys.push(defaultScope);\n            scopes.set(defaultScope, { stylesheets: [] });\n        }\n\n        // Gather sheets, and resolve to CSSStyleSheet objects\n        sheetObjects.forEach( sheet => {\n            if (typeof sheet === 'string') {\n                if (!defaultScope) {\n                    if (config.onError) { config.onError(this.ERROR_NO_SCOPE_MESSAGE + sheet); }\n                }\n                scopes.get(defaultScope).stylesheets.push( this.getSheet(sheet, config.onSuccess, config.onError) );\n            } else {\n                let scope;\n                if (sheet.scope) {\n                    scope = sheet.scope;\n                } else if (defaultScope) {\n                    scope = defaultScope;\n                } else {\n                    if (config.onError) { config.onError(this.ERROR_NO_SCOPE_MESSAGE + sheet); }\n                }\n\n                if (!scopes.has(scope)) {\n                    scopekeys.push(scope);\n                    scopes.set(scope, { stylesheets: [] });\n                }\n                scopes.get(scope).stylesheets.push( this.getSheet(sheet.url, config.onSuccess, config.onError) );\n            }\n        });\n\n        // Adopt sheet arrays per scope\n        scopekeys.forEach( scope => {\n            if (config.append.indexOf(scope) !== -1) {\n                scope.adoptedStyleSheets = scope.adoptedStyleSheets.concat(scopes.get(scope).stylesheets);\n            } else {\n                scope.adoptedStyleSheets = scopes.get(scope).stylesheets;\n            }\n        });\n    },\n\n    /**\n     * Load or retrieve cached a list of style sheets\n     * @param urls\n     * @param callback\n     * @param error\n     * @returns {Array}\n     */\n    getSheets(urls, callback, error) {\n        if (!Array.isArray(urls)) {\n            urls = [urls];\n        }\n        const sheets = [];\n        for (let c = 0; c < urls.length; c++) {\n            sheets.push(this.getSheet(urls[c], callback, error));\n        }\n        return sheets;\n    },\n\n    /**\n     * Load or retrieve cached style sheet\n     * @param url\n     * @param callback\n     * @param error\n     * @returns {CSSStyleSheet}\n     * @private\n     */\n    getSheet(url, callback, error) {\n        if (!this._dict) {\n            this._dict = new Map();\n        }\n        if (!this._failed) {\n            this._failed = new Map();\n        }\n\n        if (this._dict.has(url)) {\n            return this._dict.get(url);\n        } else if (this._failed.has(url)) {\n            error.apply(this, [this._failed.get(url)]);\n            return this._dict.get(url);\n        } else {\n            const sheet = new CSSStyleSheet();\n            sheet.replace(`@import url(\"${url}\")`)\n                .then(sheet => {\n                    if (callback) {\n                        callback.apply(this, [sheet]);\n                    }\n                })\n                .catch(err => {\n                    this._failed.set(url, err);\n                    if (error) {\n                        error.apply(this, [err]);\n                    }\n                    return sheet;\n                });\n\n            this._dict.set(url, sheet );\n            return sheet;\n        }\n    }\n}\n"],"names":[],"mappings":"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"}